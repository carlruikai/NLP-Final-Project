(base) [xuzheng_lu > lstm] (main∣⚐) ➜ python lstm_crf_tagger_conll2000.py 
Using TensorFlow backend.
======================================================================
Loading files...
Reset max_length:  78
======================================================================
Training...
2020-12-06 04:37:35.762775: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcuda.so.1
2020-12-06 04:37:36.556285: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1561] Found device 0 with properties: 
pciBusID: 0000:d8:00.0 name: Tesla V100-PCIE-16GB computeCapability: 7.0
coreClock: 1.38GHz coreCount: 80 deviceMemorySize: 15.75GiB deviceMemoryBandwidth: 836.37GiB/s
2020-12-06 04:37:36.557220: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcudart.so.10.1
2020-12-06 04:37:36.561798: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcublas.so.10
2020-12-06 04:37:36.565845: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcufft.so.10
2020-12-06 04:37:36.567351: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcurand.so.10
2020-12-06 04:37:36.572082: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcusolver.so.10
2020-12-06 04:37:36.574926: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcusparse.so.10
2020-12-06 04:37:36.583604: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcudnn.so.7
2020-12-06 04:37:36.586380: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1703] Adding visible gpu devices: 0
2020-12-06 04:37:36.586878: I tensorflow/core/platform/cpu_feature_guard.cc:143] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 AVX512F FMA
2020-12-06 04:37:36.599011: I tensorflow/core/platform/profile_utils/cpu_utils.cc:102] CPU Frequency: 2400000000 Hz
2020-12-06 04:37:36.601128: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x555559ac4780 initialized for platform Host (this does not guarantee that XLA will be used). Devices:
2020-12-06 04:37:36.601151: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device (0): Host, Default Version
2020-12-06 04:37:36.603388: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1561] Found device 0 with properties: 
pciBusID: 0000:d8:00.0 name: Tesla V100-PCIE-16GB computeCapability: 7.0
coreClock: 1.38GHz coreCount: 80 deviceMemorySize: 15.75GiB deviceMemoryBandwidth: 836.37GiB/s
2020-12-06 04:37:36.603471: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcudart.so.10.1
2020-12-06 04:37:36.603507: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcublas.so.10
2020-12-06 04:37:36.603538: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcufft.so.10
2020-12-06 04:37:36.603567: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcurand.so.10
2020-12-06 04:37:36.603597: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcusolver.so.10
2020-12-06 04:37:36.603626: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcusparse.so.10
2020-12-06 04:37:36.603655: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcudnn.so.7
2020-12-06 04:37:36.607535: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1703] Adding visible gpu devices: 0
2020-12-06 04:37:36.607599: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcudart.so.10.1
2020-12-06 04:37:36.710790: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1102] Device interconnect StreamExecutor with strength 1 edge matrix:
2020-12-06 04:37:36.710823: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1108]      0 
2020-12-06 04:37:36.710831: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1121] 0:   N 
2020-12-06 04:37:36.713433: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1247] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 14864 MB memory) -> physical GPU (device: 0, name: Tesla V100-PCIE-16GB, pci bus id: 0000:d8:00.0, compute capability: 7.0)
2020-12-06 04:37:36.715863: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x55555a594af0 initialized for platform CUDA (this does not guarantee that XLA will be used). Devices:
2020-12-06 04:37:36.715882: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device (0): Tesla V100-PCIE-16GB, Compute Capability 7.0
/SEAS/home/xuzheng_lu/anaconda3/lib/python3.8/site-packages/keras_contrib/layers/crf.py:346: UserWarning: CRF.loss_function is deprecated and it might be removed in the future. Please use losses.crf_loss instead.
  warnings.warn('CRF.loss_function is deprecated '
/SEAS/home/xuzheng_lu/anaconda3/lib/python3.8/site-packages/keras_contrib/layers/crf.py:353: UserWarning: CRF.accuracy is deprecated and it might be removed in the future. Please use metrics.crf_accuracy
  warnings.warn('CRF.accuracy is deprecated and it '
Model: "model_1"
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
input_1 (InputLayer)         (None, 78)                0         
_________________________________________________________________
embedding_1 (Embedding)      (None, 78, 20)            382480    
_________________________________________________________________
bidirectional_1 (Bidirection (None, 78, 100)           28400     
_________________________________________________________________
time_distributed_1 (TimeDist (None, 78, 50)            5050      
_________________________________________________________________
crf_1 (CRF)                  (None, 78, 23)            1748      
=================================================================
Total params: 417,678
Trainable params: 417,678
Non-trainable params: 0
_________________________________________________________________
Number of training data:  8042
Number of validation data:  894
/SEAS/home/xuzheng_lu/anaconda3/lib/python3.8/site-packages/tensorflow/python/framework/indexed_slices.py:433: UserWarning: Converting sparse IndexedSlices to a dense Tensor of unknown shape. This may consume a large amount of memory.
  warnings.warn(
Train on 8042 samples, validate on 894 samples
Epoch 1/50
2020-12-06 04:37:40.768925: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcublas.so.10
8042/8042 [==============================] - 11s 1ms/step - loss: 1.2807 - crf_viterbi_accuracy: 0.6993 - val_loss: 0.7290 - val_crf_viterbi_accuracy: 0.7773

Epoch 00001: val_loss improved from inf to 0.72905, saving model to weights.best.conll2000.hdf5
Epoch 2/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.6596 - crf_viterbi_accuracy: 0.7776 - val_loss: 0.6004 - val_crf_viterbi_accuracy: 0.7860

Epoch 00002: val_loss improved from 0.72905 to 0.60043, saving model to weights.best.conll2000.hdf5
Epoch 3/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.5808 - crf_viterbi_accuracy: 0.7899 - val_loss: 0.5518 - val_crf_viterbi_accuracy: 0.8007

Epoch 00003: val_loss improved from 0.60043 to 0.55175, saving model to weights.best.conll2000.hdf5
Epoch 4/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.5407 - crf_viterbi_accuracy: 0.8019 - val_loss: 0.5118 - val_crf_viterbi_accuracy: 0.8093

Epoch 00004: val_loss improved from 0.55175 to 0.51184, saving model to weights.best.conll2000.hdf5
Epoch 5/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.4830 - crf_viterbi_accuracy: 0.8177 - val_loss: 0.4332 - val_crf_viterbi_accuracy: 0.8449

Epoch 00005: val_loss improved from 0.51184 to 0.43321, saving model to weights.best.conll2000.hdf5
Epoch 6/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.3917 - crf_viterbi_accuracy: 0.8568 - val_loss: 0.3523 - val_crf_viterbi_accuracy: 0.8710

Epoch 00006: val_loss improved from 0.43321 to 0.35231, saving model to weights.best.conll2000.hdf5
Epoch 7/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.3213 - crf_viterbi_accuracy: 0.8882 - val_loss: 0.2970 - val_crf_viterbi_accuracy: 0.8996

Epoch 00007: val_loss improved from 0.35231 to 0.29703, saving model to weights.best.conll2000.hdf5
Epoch 8/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.2757 - crf_viterbi_accuracy: 0.9102 - val_loss: 0.2606 - val_crf_viterbi_accuracy: 0.9191

Epoch 00008: val_loss improved from 0.29703 to 0.26056, saving model to weights.best.conll2000.hdf5
Epoch 9/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.2324 - crf_viterbi_accuracy: 0.9332 - val_loss: 0.2157 - val_crf_viterbi_accuracy: 0.9412

Epoch 00009: val_loss improved from 0.26056 to 0.21572, saving model to weights.best.conll2000.hdf5
Epoch 10/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.1916 - crf_viterbi_accuracy: 0.9483 - val_loss: 0.1817 - val_crf_viterbi_accuracy: 0.9510

Epoch 00010: val_loss improved from 0.21572 to 0.18170, saving model to weights.best.conll2000.hdf5
Epoch 11/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.1587 - crf_viterbi_accuracy: 0.9573 - val_loss: 0.1522 - val_crf_viterbi_accuracy: 0.9603

Epoch 00011: val_loss improved from 0.18170 to 0.15225, saving model to weights.best.conll2000.hdf5
Epoch 12/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.1347 - crf_viterbi_accuracy: 0.9632 - val_loss: 0.1374 - val_crf_viterbi_accuracy: 0.9600

Epoch 00012: val_loss improved from 0.15225 to 0.13737, saving model to weights.best.conll2000.hdf5
Epoch 13/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.1179 - crf_viterbi_accuracy: 0.9675 - val_loss: 0.1230 - val_crf_viterbi_accuracy: 0.9668

Epoch 00013: val_loss improved from 0.13737 to 0.12295, saving model to weights.best.conll2000.hdf5
Epoch 14/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.1070 - crf_viterbi_accuracy: 0.9701 - val_loss: 0.1169 - val_crf_viterbi_accuracy: 0.9680

Epoch 00014: val_loss improved from 0.12295 to 0.11693, saving model to weights.best.conll2000.hdf5
Epoch 15/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0977 - crf_viterbi_accuracy: 0.9726 - val_loss: 0.1132 - val_crf_viterbi_accuracy: 0.9681

Epoch 00015: val_loss improved from 0.11693 to 0.11322, saving model to weights.best.conll2000.hdf5
Epoch 16/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0911 - crf_viterbi_accuracy: 0.9745 - val_loss: 0.1052 - val_crf_viterbi_accuracy: 0.9713

Epoch 00016: val_loss improved from 0.11322 to 0.10518, saving model to weights.best.conll2000.hdf5
Epoch 17/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0845 - crf_viterbi_accuracy: 0.9763 - val_loss: 0.1070 - val_crf_viterbi_accuracy: 0.9700

Epoch 00017: val_loss did not improve from 0.10518
Epoch 18/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0798 - crf_viterbi_accuracy: 0.9774 - val_loss: 0.0992 - val_crf_viterbi_accuracy: 0.9714

Epoch 00018: val_loss improved from 0.10518 to 0.09921, saving model to weights.best.conll2000.hdf5
Epoch 19/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0745 - crf_viterbi_accuracy: 0.9788 - val_loss: 0.0962 - val_crf_viterbi_accuracy: 0.9721

Epoch 00019: val_loss improved from 0.09921 to 0.09625, saving model to weights.best.conll2000.hdf5
Epoch 20/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0700 - crf_viterbi_accuracy: 0.9800 - val_loss: 0.0899 - val_crf_viterbi_accuracy: 0.9748

Epoch 00020: val_loss improved from 0.09625 to 0.08993, saving model to weights.best.conll2000.hdf5
Epoch 21/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0655 - crf_viterbi_accuracy: 0.9807 - val_loss: 0.0872 - val_crf_viterbi_accuracy: 0.9747

Epoch 00021: val_loss improved from 0.08993 to 0.08725, saving model to weights.best.conll2000.hdf5
Epoch 22/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0613 - crf_viterbi_accuracy: 0.9817 - val_loss: 0.0845 - val_crf_viterbi_accuracy: 0.9756

Epoch 00022: val_loss improved from 0.08725 to 0.08446, saving model to weights.best.conll2000.hdf5
Epoch 23/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0571 - crf_viterbi_accuracy: 0.9829 - val_loss: 0.0817 - val_crf_viterbi_accuracy: 0.9754

Epoch 00023: val_loss improved from 0.08446 to 0.08169, saving model to weights.best.conll2000.hdf5
Epoch 24/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0532 - crf_viterbi_accuracy: 0.9837 - val_loss: 0.0791 - val_crf_viterbi_accuracy: 0.9759

Epoch 00024: val_loss improved from 0.08169 to 0.07912, saving model to weights.best.conll2000.hdf5
Epoch 25/50
8042/8042 [==============================] - 9s 1ms/step - loss: 0.0497 - crf_viterbi_accuracy: 0.9844 - val_loss: 0.0759 - val_crf_viterbi_accuracy: 0.9766

Epoch 00025: val_loss improved from 0.07912 to 0.07595, saving model to weights.best.conll2000.hdf5
Epoch 26/50
8042/8042 [==============================] - 9s 1ms/step - loss: 0.0462 - crf_viterbi_accuracy: 0.9853 - val_loss: 0.0734 - val_crf_viterbi_accuracy: 0.9771

Epoch 00026: val_loss improved from 0.07595 to 0.07339, saving model to weights.best.conll2000.hdf5
Epoch 27/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0431 - crf_viterbi_accuracy: 0.9858 - val_loss: 0.0718 - val_crf_viterbi_accuracy: 0.9767

Epoch 00027: val_loss improved from 0.07339 to 0.07184, saving model to weights.best.conll2000.hdf5
Epoch 28/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0398 - crf_viterbi_accuracy: 0.9867 - val_loss: 0.0700 - val_crf_viterbi_accuracy: 0.9776

Epoch 00028: val_loss improved from 0.07184 to 0.07005, saving model to weights.best.conll2000.hdf5
Epoch 29/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0374 - crf_viterbi_accuracy: 0.9870 - val_loss: 0.0674 - val_crf_viterbi_accuracy: 0.9779

Epoch 00029: val_loss improved from 0.07005 to 0.06743, saving model to weights.best.conll2000.hdf5
Epoch 30/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0344 - crf_viterbi_accuracy: 0.9879 - val_loss: 0.0668 - val_crf_viterbi_accuracy: 0.9785

Epoch 00030: val_loss improved from 0.06743 to 0.06678, saving model to weights.best.conll2000.hdf5
Epoch 31/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0319 - crf_viterbi_accuracy: 0.9885 - val_loss: 0.0659 - val_crf_viterbi_accuracy: 0.9784

Epoch 00031: val_loss improved from 0.06678 to 0.06592, saving model to weights.best.conll2000.hdf5
Epoch 32/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0296 - crf_viterbi_accuracy: 0.9890 - val_loss: 0.0642 - val_crf_viterbi_accuracy: 0.9783

Epoch 00032: val_loss improved from 0.06592 to 0.06425, saving model to weights.best.conll2000.hdf5
Epoch 33/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0275 - crf_viterbi_accuracy: 0.9897 - val_loss: 0.0640 - val_crf_viterbi_accuracy: 0.9786

Epoch 00033: val_loss improved from 0.06425 to 0.06403, saving model to weights.best.conll2000.hdf5
Epoch 34/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0253 - crf_viterbi_accuracy: 0.9901 - val_loss: 0.0623 - val_crf_viterbi_accuracy: 0.9792

Epoch 00034: val_loss improved from 0.06403 to 0.06227, saving model to weights.best.conll2000.hdf5
Epoch 35/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0234 - crf_viterbi_accuracy: 0.9904 - val_loss: 0.0598 - val_crf_viterbi_accuracy: 0.9793

Epoch 00035: val_loss improved from 0.06227 to 0.05982, saving model to weights.best.conll2000.hdf5
Epoch 36/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0214 - crf_viterbi_accuracy: 0.9910 - val_loss: 0.0601 - val_crf_viterbi_accuracy: 0.9789

Epoch 00036: val_loss did not improve from 0.05982
Epoch 37/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0196 - crf_viterbi_accuracy: 0.9914 - val_loss: 0.0594 - val_crf_viterbi_accuracy: 0.9788

Epoch 00037: val_loss improved from 0.05982 to 0.05937, saving model to weights.best.conll2000.hdf5
Epoch 38/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0178 - crf_viterbi_accuracy: 0.9918 - val_loss: 0.0587 - val_crf_viterbi_accuracy: 0.9792

Epoch 00038: val_loss improved from 0.05937 to 0.05874, saving model to weights.best.conll2000.hdf5
Epoch 39/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0160 - crf_viterbi_accuracy: 0.9923 - val_loss: 0.0608 - val_crf_viterbi_accuracy: 0.9787

Epoch 00039: val_loss did not improve from 0.05874
Epoch 40/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0146 - crf_viterbi_accuracy: 0.9924 - val_loss: 0.0618 - val_crf_viterbi_accuracy: 0.9783

Epoch 00040: val_loss did not improve from 0.05874
Epoch 41/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0130 - crf_viterbi_accuracy: 0.9928 - val_loss: 0.0568 - val_crf_viterbi_accuracy: 0.9789

Epoch 00041: val_loss improved from 0.05874 to 0.05684, saving model to weights.best.conll2000.hdf5
Epoch 42/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0116 - crf_viterbi_accuracy: 0.9930 - val_loss: 0.0576 - val_crf_viterbi_accuracy: 0.9788

Epoch 00042: val_loss did not improve from 0.05684
Epoch 43/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0100 - crf_viterbi_accuracy: 0.9933 - val_loss: 0.0596 - val_crf_viterbi_accuracy: 0.9781

Epoch 00043: val_loss did not improve from 0.05684
Epoch 44/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0088 - crf_viterbi_accuracy: 0.9937 - val_loss: 0.0575 - val_crf_viterbi_accuracy: 0.9789

Epoch 00044: val_loss did not improve from 0.05684
Epoch 45/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0075 - crf_viterbi_accuracy: 0.9939 - val_loss: 0.0572 - val_crf_viterbi_accuracy: 0.9783

Epoch 00045: val_loss did not improve from 0.05684
Epoch 46/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0062 - crf_viterbi_accuracy: 0.9941 - val_loss: 0.0572 - val_crf_viterbi_accuracy: 0.9788

Epoch 00046: val_loss did not improve from 0.05684
Epoch 47/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0051 - crf_viterbi_accuracy: 0.9944 - val_loss: 0.0569 - val_crf_viterbi_accuracy: 0.9783

Epoch 00047: val_loss did not improve from 0.05684
Epoch 48/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0039 - crf_viterbi_accuracy: 0.9947 - val_loss: 0.0575 - val_crf_viterbi_accuracy: 0.9790

Epoch 00048: val_loss did not improve from 0.05684
Epoch 49/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0026 - crf_viterbi_accuracy: 0.9949 - val_loss: 0.0577 - val_crf_viterbi_accuracy: 0.9782

Epoch 00049: val_loss did not improve from 0.05684
Epoch 50/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0016 - crf_viterbi_accuracy: 0.9952 - val_loss: 0.0573 - val_crf_viterbi_accuracy: 0.9783

Epoch 00050: val_loss did not improve from 0.05684
======================================================================
Loading files...
======================================================================
Testing...
======================================================================
Accuracy: 97.6959%
Runtime: 505.01s
======================================================================