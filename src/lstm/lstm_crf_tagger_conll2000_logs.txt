(base) [xuzheng_lu > lstm] (main∣) ➜ python lstm_crf_tagger_conll2000.py 
Using TensorFlow backend.
======================================================================
Loading files...
Reset max_length:  78
======================================================================
Training...
2020-12-05 23:59:23.027229: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcuda.so.1
2020-12-05 23:59:24.854404: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1561] Found device 0 with properties: 
pciBusID: 0000:d8:00.0 name: Tesla V100-PCIE-16GB computeCapability: 7.0
coreClock: 1.38GHz coreCount: 80 deviceMemorySize: 15.75GiB deviceMemoryBandwidth: 836.37GiB/s
2020-12-05 23:59:24.855792: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcudart.so.10.1
2020-12-05 23:59:24.859338: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcublas.so.10
2020-12-05 23:59:24.862134: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcufft.so.10
2020-12-05 23:59:24.863239: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcurand.so.10
2020-12-05 23:59:24.865614: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcusolver.so.10
2020-12-05 23:59:24.867165: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcusparse.so.10
2020-12-05 23:59:24.871822: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcudnn.so.7
2020-12-05 23:59:24.873198: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1703] Adding visible gpu devices: 0
2020-12-05 23:59:24.874027: I tensorflow/core/platform/cpu_feature_guard.cc:143] Your CPU supports instructions that this TensorFlow binary was not compiled to use: SSE4.1 SSE4.2 AVX AVX2 AVX512F FMA
2020-12-05 23:59:24.886085: I tensorflow/core/platform/profile_utils/cpu_utils.cc:102] CPU Frequency: 2400000000 Hz
2020-12-05 23:59:24.888013: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x555559ac4cb0 initialized for platform Host (this does not guarantee that XLA will be used). Devices:
2020-12-05 23:59:24.888037: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device (0): Host, Default Version
2020-12-05 23:59:24.888888: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1561] Found device 0 with properties: 
pciBusID: 0000:d8:00.0 name: Tesla V100-PCIE-16GB computeCapability: 7.0
coreClock: 1.38GHz coreCount: 80 deviceMemorySize: 15.75GiB deviceMemoryBandwidth: 836.37GiB/s
2020-12-05 23:59:24.888926: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcudart.so.10.1
2020-12-05 23:59:24.888937: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcublas.so.10
2020-12-05 23:59:24.888946: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcufft.so.10
2020-12-05 23:59:24.888955: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcurand.so.10
2020-12-05 23:59:24.888964: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcusolver.so.10
2020-12-05 23:59:24.888972: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcusparse.so.10
2020-12-05 23:59:24.888981: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcudnn.so.7
2020-12-05 23:59:24.890319: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1703] Adding visible gpu devices: 0
2020-12-05 23:59:24.890343: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcudart.so.10.1
2020-12-05 23:59:24.986211: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1102] Device interconnect StreamExecutor with strength 1 edge matrix:
2020-12-05 23:59:24.986253: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1108]      0 
2020-12-05 23:59:24.986264: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1121] 0:   N 
2020-12-05 23:59:24.988539: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1247] Created TensorFlow device (/job:localhost/replica:0/task:0/device:GPU:0 with 14864 MB memory) -> physical GPU (device: 0, name: Tesla V100-PCIE-16GB, pci bus id: 0000:d8:00.0, compute capability: 7.0)
2020-12-05 23:59:24.991087: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x55555a594f40 initialized for platform CUDA (this does not guarantee that XLA will be used). Devices:
2020-12-05 23:59:24.991105: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device (0): Tesla V100-PCIE-16GB, Compute Capability 7.0
/SEAS/home/xuzheng_lu/anaconda3/lib/python3.8/site-packages/keras_contrib/layers/crf.py:346: UserWarning: CRF.loss_function is deprecated and it might be removed in the future. Please use losses.crf_loss instead.
  warnings.warn('CRF.loss_function is deprecated '
/SEAS/home/xuzheng_lu/anaconda3/lib/python3.8/site-packages/keras_contrib/layers/crf.py:353: UserWarning: CRF.accuracy is deprecated and it might be removed in the future. Please use metrics.crf_accuracy
  warnings.warn('CRF.accuracy is deprecated and it '
Model: "model_1"
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
input_1 (InputLayer)         (None, 78)                0         
_________________________________________________________________
embedding_1 (Embedding)      (None, 78, 20)            382480    
_________________________________________________________________
bidirectional_1 (Bidirection (None, 78, 100)           28400     
_________________________________________________________________
time_distributed_1 (TimeDist (None, 78, 50)            5050      
_________________________________________________________________
crf_1 (CRF)                  (None, 78, 23)            1748      
=================================================================
Total params: 417,678
Trainable params: 417,678
Non-trainable params: 0
_________________________________________________________________
Number of training data:  8042
Number of validation data:  894
/SEAS/home/xuzheng_lu/anaconda3/lib/python3.8/site-packages/tensorflow/python/framework/indexed_slices.py:433: UserWarning: Converting sparse IndexedSlices to a dense Tensor of unknown shape. This may consume a large amount of memory.
  warnings.warn(
Train on 8042 samples, validate on 894 samples
Epoch 1/50
2020-12-05 23:59:30.389262: I tensorflow/stream_executor/platform/default/dso_loader.cc:44] Successfully opened dynamic library libcublas.so.10
8042/8042 [==============================] - 12s 1ms/step - loss: 1.2105 - crf_viterbi_accuracy: 0.6752 - val_loss: 0.6952 - val_crf_viterbi_accuracy: 0.7487

Epoch 00001: val_loss improved from inf to 0.69520, saving model to weights.best.conll2000.hdf5
Epoch 2/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.6321 - crf_viterbi_accuracy: 0.7757 - val_loss: 0.5901 - val_crf_viterbi_accuracy: 0.7815

Epoch 00002: val_loss improved from 0.69520 to 0.59010, saving model to weights.best.conll2000.hdf5
Epoch 3/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.5625 - crf_viterbi_accuracy: 0.7890 - val_loss: 0.5438 - val_crf_viterbi_accuracy: 0.7912

Epoch 00003: val_loss improved from 0.59010 to 0.54379, saving model to weights.best.conll2000.hdf5
Epoch 4/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.5242 - crf_viterbi_accuracy: 0.7994 - val_loss: 0.5049 - val_crf_viterbi_accuracy: 0.7982

Epoch 00004: val_loss improved from 0.54379 to 0.50485, saving model to weights.best.conll2000.hdf5
Epoch 5/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.4633 - crf_viterbi_accuracy: 0.8293 - val_loss: 0.4209 - val_crf_viterbi_accuracy: 0.8569

Epoch 00005: val_loss improved from 0.50485 to 0.42089, saving model to weights.best.conll2000.hdf5
Epoch 6/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.3722 - crf_viterbi_accuracy: 0.8841 - val_loss: 0.3324 - val_crf_viterbi_accuracy: 0.8957

Epoch 00006: val_loss improved from 0.42089 to 0.33243, saving model to weights.best.conll2000.hdf5
Epoch 7/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.2993 - crf_viterbi_accuracy: 0.9088 - val_loss: 0.2849 - val_crf_viterbi_accuracy: 0.9096

Epoch 00007: val_loss improved from 0.33243 to 0.28486, saving model to weights.best.conll2000.hdf5
Epoch 8/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.2571 - crf_viterbi_accuracy: 0.9185 - val_loss: 0.2513 - val_crf_viterbi_accuracy: 0.9156

Epoch 00008: val_loss improved from 0.28486 to 0.25128, saving model to weights.best.conll2000.hdf5
Epoch 9/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.2242 - crf_viterbi_accuracy: 0.9295 - val_loss: 0.2189 - val_crf_viterbi_accuracy: 0.9287

Epoch 00009: val_loss improved from 0.25128 to 0.21893, saving model to weights.best.conll2000.hdf5
Epoch 10/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.1906 - crf_viterbi_accuracy: 0.9440 - val_loss: 0.1855 - val_crf_viterbi_accuracy: 0.9443

Epoch 00010: val_loss improved from 0.21893 to 0.18554, saving model to weights.best.conll2000.hdf5
Epoch 11/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.1592 - crf_viterbi_accuracy: 0.9560 - val_loss: 0.1588 - val_crf_viterbi_accuracy: 0.9538

Epoch 00011: val_loss improved from 0.18554 to 0.15880, saving model to weights.best.conll2000.hdf5
Epoch 12/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.1349 - crf_viterbi_accuracy: 0.9625 - val_loss: 0.1353 - val_crf_viterbi_accuracy: 0.9592

Epoch 00012: val_loss improved from 0.15880 to 0.13527, saving model to weights.best.conll2000.hdf5
Epoch 13/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.1160 - crf_viterbi_accuracy: 0.9669 - val_loss: 0.1200 - val_crf_viterbi_accuracy: 0.9625

Epoch 00013: val_loss improved from 0.13527 to 0.12002, saving model to weights.best.conll2000.hdf5
Epoch 14/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.1023 - crf_viterbi_accuracy: 0.9706 - val_loss: 0.1088 - val_crf_viterbi_accuracy: 0.9665

Epoch 00014: val_loss improved from 0.12002 to 0.10878, saving model to weights.best.conll2000.hdf5
Epoch 15/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0910 - crf_viterbi_accuracy: 0.9739 - val_loss: 0.1000 - val_crf_viterbi_accuracy: 0.9697

Epoch 00015: val_loss improved from 0.10878 to 0.10001, saving model to weights.best.conll2000.hdf5
Epoch 16/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0829 - crf_viterbi_accuracy: 0.9761 - val_loss: 0.0936 - val_crf_viterbi_accuracy: 0.9709

Epoch 00016: val_loss improved from 0.10001 to 0.09360, saving model to weights.best.conll2000.hdf5
Epoch 17/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0750 - crf_viterbi_accuracy: 0.9782 - val_loss: 0.0894 - val_crf_viterbi_accuracy: 0.9723

Epoch 00017: val_loss improved from 0.09360 to 0.08943, saving model to weights.best.conll2000.hdf5
Epoch 18/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0689 - crf_viterbi_accuracy: 0.9799 - val_loss: 0.0845 - val_crf_viterbi_accuracy: 0.9728

Epoch 00018: val_loss improved from 0.08943 to 0.08448, saving model to weights.best.conll2000.hdf5
Epoch 19/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0632 - crf_viterbi_accuracy: 0.9811 - val_loss: 0.0803 - val_crf_viterbi_accuracy: 0.9741

Epoch 00019: val_loss improved from 0.08448 to 0.08025, saving model to weights.best.conll2000.hdf5
Epoch 20/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0579 - crf_viterbi_accuracy: 0.9825 - val_loss: 0.0754 - val_crf_viterbi_accuracy: 0.9755

Epoch 00020: val_loss improved from 0.08025 to 0.07544, saving model to weights.best.conll2000.hdf5
Epoch 21/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0536 - crf_viterbi_accuracy: 0.9834 - val_loss: 0.0730 - val_crf_viterbi_accuracy: 0.9760

Epoch 00021: val_loss improved from 0.07544 to 0.07297, saving model to weights.best.conll2000.hdf5
Epoch 22/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0493 - crf_viterbi_accuracy: 0.9844 - val_loss: 0.0702 - val_crf_viterbi_accuracy: 0.9764

Epoch 00022: val_loss improved from 0.07297 to 0.07021, saving model to weights.best.conll2000.hdf5
Epoch 23/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0457 - crf_viterbi_accuracy: 0.9852 - val_loss: 0.0704 - val_crf_viterbi_accuracy: 0.9758

Epoch 00023: val_loss did not improve from 0.07021
Epoch 24/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0423 - crf_viterbi_accuracy: 0.9860 - val_loss: 0.0661 - val_crf_viterbi_accuracy: 0.9775

Epoch 00024: val_loss improved from 0.07021 to 0.06607, saving model to weights.best.conll2000.hdf5
Epoch 25/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0391 - crf_viterbi_accuracy: 0.9868 - val_loss: 0.0654 - val_crf_viterbi_accuracy: 0.9769

Epoch 00025: val_loss improved from 0.06607 to 0.06541, saving model to weights.best.conll2000.hdf5
Epoch 26/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0362 - crf_viterbi_accuracy: 0.9875 - val_loss: 0.0645 - val_crf_viterbi_accuracy: 0.9775

Epoch 00026: val_loss improved from 0.06541 to 0.06453, saving model to weights.best.conll2000.hdf5
Epoch 27/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0337 - crf_viterbi_accuracy: 0.9879 - val_loss: 0.0622 - val_crf_viterbi_accuracy: 0.9784

Epoch 00027: val_loss improved from 0.06453 to 0.06218, saving model to weights.best.conll2000.hdf5
Epoch 28/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0311 - crf_viterbi_accuracy: 0.9885 - val_loss: 0.0600 - val_crf_viterbi_accuracy: 0.9790

Epoch 00028: val_loss improved from 0.06218 to 0.05999, saving model to weights.best.conll2000.hdf5
Epoch 29/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0287 - crf_viterbi_accuracy: 0.9892 - val_loss: 0.0606 - val_crf_viterbi_accuracy: 0.9784

Epoch 00029: val_loss did not improve from 0.05999
Epoch 30/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0267 - crf_viterbi_accuracy: 0.9896 - val_loss: 0.0594 - val_crf_viterbi_accuracy: 0.9789

Epoch 00030: val_loss improved from 0.05999 to 0.05943, saving model to weights.best.conll2000.hdf5
Epoch 31/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0248 - crf_viterbi_accuracy: 0.9900 - val_loss: 0.0593 - val_crf_viterbi_accuracy: 0.9785

Epoch 00031: val_loss improved from 0.05943 to 0.05928, saving model to weights.best.conll2000.hdf5
Epoch 32/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0228 - crf_viterbi_accuracy: 0.9905 - val_loss: 0.0576 - val_crf_viterbi_accuracy: 0.9793

Epoch 00032: val_loss improved from 0.05928 to 0.05761, saving model to weights.best.conll2000.hdf5
Epoch 33/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0210 - crf_viterbi_accuracy: 0.9909 - val_loss: 0.0573 - val_crf_viterbi_accuracy: 0.9790

Epoch 00033: val_loss improved from 0.05761 to 0.05727, saving model to weights.best.conll2000.hdf5
Epoch 34/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0193 - crf_viterbi_accuracy: 0.9913 - val_loss: 0.0619 - val_crf_viterbi_accuracy: 0.9773

Epoch 00034: val_loss did not improve from 0.05727
Epoch 35/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0176 - crf_viterbi_accuracy: 0.9916 - val_loss: 0.0585 - val_crf_viterbi_accuracy: 0.9785

Epoch 00035: val_loss did not improve from 0.05727
Epoch 36/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0160 - crf_viterbi_accuracy: 0.9919 - val_loss: 0.0595 - val_crf_viterbi_accuracy: 0.9782

Epoch 00036: val_loss did not improve from 0.05727
Epoch 37/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0146 - crf_viterbi_accuracy: 0.9924 - val_loss: 0.0580 - val_crf_viterbi_accuracy: 0.9783

Epoch 00037: val_loss did not improve from 0.05727
Epoch 38/50
8042/8042 [==============================] - 10s 1ms/step - loss: 0.0132 - crf_viterbi_accuracy: 0.9926 - val_loss: 0.0565 - val_crf_viterbi_accuracy: 0.9786

Epoch 00038: val_loss improved from 0.05727 to 0.05646, saving model to weights.best.conll2000.hdf5
Epoch 39/50
8042/8042 [==============================] - 9s 1ms/step - loss: 0.0119 - crf_viterbi_accuracy: 0.9929 - val_loss: 0.0591 - val_crf_viterbi_accuracy: 0.9778

Epoch 00039: val_loss did not improve from 0.05646
Epoch 40/50
8042/8042 [==============================] - 9s 1ms/step - loss: 0.0107 - crf_viterbi_accuracy: 0.9931 - val_loss: 0.0575 - val_crf_viterbi_accuracy: 0.9782

Epoch 00040: val_loss did not improve from 0.05646
Epoch 41/50
8042/8042 [==============================] - 9s 1ms/step - loss: 0.0092 - crf_viterbi_accuracy: 0.9934 - val_loss: 0.0577 - val_crf_viterbi_accuracy: 0.9779

Epoch 00041: val_loss did not improve from 0.05646
Epoch 42/50
8042/8042 [==============================] - 9s 1ms/step - loss: 0.0082 - crf_viterbi_accuracy: 0.9936 - val_loss: 0.0554 - val_crf_viterbi_accuracy: 0.9790

Epoch 00042: val_loss improved from 0.05646 to 0.05535, saving model to weights.best.conll2000.hdf5
Epoch 43/50
8042/8042 [==============================] - 9s 1ms/step - loss: 0.0070 - crf_viterbi_accuracy: 0.9938 - val_loss: 0.0562 - val_crf_viterbi_accuracy: 0.9782

Epoch 00043: val_loss did not improve from 0.05535
Epoch 44/50
8042/8042 [==============================] - 9s 1ms/step - loss: 0.0058 - crf_viterbi_accuracy: 0.9941 - val_loss: 0.0614 - val_crf_viterbi_accuracy: 0.9764

Epoch 00044: val_loss did not improve from 0.05535
Epoch 45/50
8042/8042 [==============================] - 9s 1ms/step - loss: 0.0046 - crf_viterbi_accuracy: 0.9943 - val_loss: 0.0583 - val_crf_viterbi_accuracy: 0.9777

Epoch 00045: val_loss did not improve from 0.05535
Epoch 46/50
8042/8042 [==============================] - 9s 1ms/step - loss: 0.0035 - crf_viterbi_accuracy: 0.9945 - val_loss: 0.0565 - val_crf_viterbi_accuracy: 0.9784

Epoch 00046: val_loss did not improve from 0.05535
Epoch 47/50
8042/8042 [==============================] - 9s 1ms/step - loss: 0.0024 - crf_viterbi_accuracy: 0.9948 - val_loss: 0.0567 - val_crf_viterbi_accuracy: 0.9782

Epoch 00047: val_loss did not improve from 0.05535
Epoch 48/50
8042/8042 [==============================] - 9s 1ms/step - loss: 0.0016 - crf_viterbi_accuracy: 0.9948 - val_loss: 0.0566 - val_crf_viterbi_accuracy: 0.9781

Epoch 00048: val_loss did not improve from 0.05535
Epoch 49/50
8042/8042 [==============================] - 9s 1ms/step - loss: 4.2086e-04 - crf_viterbi_accuracy: 0.9952 - val_loss: 0.0568 - val_crf_viterbi_accuracy: 0.9780

Epoch 00049: val_loss did not improve from 0.05535
Epoch 50/50
8042/8042 [==============================] - 9s 1ms/step - loss: -4.5484e-04 - crf_viterbi_accuracy: 0.9951 - val_loss: 0.0577 - val_crf_viterbi_accuracy: 0.9777

Epoch 00050: val_loss did not improve from 0.05535
======================================================================
Loading files...
======================================================================
Testing...
======================================================================
Accuracy: 97.6532%
Runtime: 494.07s
======================================================================